<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Active Directory Series - Machine 1 - DZ Blog</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/post.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header class="header">
        <div class="container">
            <h1 class="logo"><a href="../index.html"><span class="logo-draco">Draco</span><span class="logo-zona">Zona</span><span class="cursor">_</span></a></h1>
            <nav class="nav">
                <a href="../index.html">Blog</a>
                <a href="../about.html">About</a>
                <a href="../cv.html">CV</a>
                <a href="../certifications.html">Certifications</a>
                <a href="../contact.html">Contact</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <article class="post">
                <div class="back-to-blog">
                    <a href="../index.html" class="back-btn">‚Üê Back to Blog</a>
                </div>
                
                <header class="post-header">
                    <div class="post-meta">
                        <span class="post-date">March 30, 2025</span>
                        <span class="post-category">Active Directory</span>
                    </div>
                    <h1 class="post-title">Active Directory Series - Machine 1</h1>
                    <div class="post-tags">
                        <span class="tag">AD</span><span class="tag">HTB</span><span class="tag">Offensive Security</span>
                    </div>
                </header>

                <div class="post-content">
                    <p><h1>Introduction</h1></p><p>Hello! I decided to take the <code>Active Directory Exploitation</code> track on HackTheBox. </p><p><img src="../images//ad-series-1/image1.png" alt="Desktop View" class="post-image"></p><p>I don't know. Just to get my feet wet with AD attacks since I am planning to take the CPTS exam within this year. <br>So in the list of machines, this is the first machine and it is entitled "CICADA". Cool name and it is labeled easy. Is it? You'll see as you read further on my blog.</p><p><h1>Recon and Enum Phase</h1></p><p>First, I ran an nmap scan to check for open ports:</p><p><div class="code-block"><pre><code><br>nmap -sCV -p- --min-rate 300 -vv <IP> -Pn<br></code></pre></div></p><p>While waiting for that to finish, it was indicated in the scan that there was port 139 and 445 and it was open. From that information, I fired up another terminal and <br>use crackmapexec to enumerate shares if that is possible. </p><p><div class="code-block"><pre><code><br>crackmapexec smb <IP> -u "" -p "" --shares<br></code></pre></div><br><img src="../images/ad-series-1/ss1.png" alt="Desktop View" class="post-image"></p><p>I have found 2 shares that has READ permissions. HR and IPC$. So I tried to connect to the HR share to see if I am allowed to do that and if so, to check if there are <br>files that could be useful.<br><img src="../images//ad-series-1/ss2.png" alt="Desktop View" class="post-image"></p><p>There is one file entitled "Notice from HR.txt" that I found. I checked its contents and I found out that this was a welcome message to new hires and it was indicated in the message the default password that was provided to them. That is so juicy.<br><img src="../images//ad-series-1/ss3.png" alt="" class="post-image"></p><p>At this point, I was thinking maybe that there is a user who still uses the default password. You never know, right? So I fired up <code>crackmapexec</code> to enumerate users, but it shows nothing.</p><p><div class="code-block"><pre><code><br>crackmapexec smb <> -u "" -p "" --shares<br></code></pre></div><br><img src="../images//ad-series-1/ss4.png" alt="" class="post-image"></p><p>So I tried using another tool. I used <code>lookupsid</code> that is from <code>impacket</code>.<br><div class="prompt-info"><strong>lookupsid</strong> is a tool that allows attackers to enumerate user SIDs (Security Identifiers) and group SIDs on a Windows System.</div></p><p>Using <code>lookupsid</code> tool, I was able to retrieve the list of users.<br><img src="../images//ad-series-1/ss5.png" alt="" class="post-image"></p><p><br>With the list of users and the default password I got from the file, I executed a passwordspray attack using <code>netexec</code>.<br><div class="code-block"><pre><code><br>nxc smb <IP> -u domain_users.txt -p <password> --continue-on-success<br></code></pre></div><br>So it seemed that <code>Michael Wrightson</code> did not change his default password. What a shame :<><br><img src="../images//ad-series-1/ss6.png" alt="" class="post-image"></p><p>I used the credentials of Michael to further enumerate users to check if there are any juicy information that I could retrieve from them.<br><div class="code-block"><pre><code><br>nxc smb <IP> -u "michael.wrightson" -p <password> --users<br></code></pre></div></p><p>After executing the command, I found a user that has a description about his password. So now I also have the credentials of David Orelious. This is getting interesting. </p><p><img src="../images//ad-series-1/ss7.png" alt="" class="post-image"></p><p>Since I've got 2 users with credentials already and I tried checking if I can use them to access the DEV share that I found earlier. The user <code>David</code> was the one that got in.<br><div class="code-block"><pre><code><br>smbclient -U david.orelious \\\\{IP Address}\\DEV<br></code></pre></div></p><p> I found a powershell script inside the share which was interesting since the filename was <code>Backup_script.ps1</code><br> <img src="../images//ad-series-1/ss8.png" alt="" class="post-image"></p><p>I looked into the file and I found another user and its password! <br> <img src="../images//ad-series-1/ss9.png" alt="" class="post-image"></p><p><h1>Gaining Initial Foothold</h1></p><p>This is the part where I gained initial access. I used the credentials of emily to initiate remote connection using <code>evil-winrm</code> tool. <br><div class="prompt-warning"><strong>evil-winrm</strong> is a tool that provides remote shell access to Windows machines over WinRM (Windows Remote Management)</div></p><p><div class="code-block"><pre><code><br>evil-winrm -i <IP> -u emily.oscars -p <password><br></code></pre></div></p><p>I have now a remote access through the user <code>Emily</code>.<br> <img src="../images//ad-series-1/ss10.png" alt="" class="post-image"></p><p>At this point, I got myself into a rabbit hole, so I'm gonna skip that part where I go back and forth with some things and go directly on how to escalate privileges. </p><p><h1>Privilege Escalation</h1></p><p>First I checked which privileges I got using the user <code>Emily</code>. I found out that it has <code>SeBackupPrivilege</code> set to <code>Enabled</code>.<br> <img src="../images//ad-series-1/ss12.png" alt="" class="post-image"><br><div class="prompt-danger"><strong>SeBackupPrivilege</strong> is a User Right Assignment in Windows Active Directory (AD) that allows a user or process to bypass file and directory security restrictions for backup purposes. Attackers who gain this privilege can bypass access controls and read sensitive files, including NTDS.dit (which contains AD password hashes). It can be abused to escalate privileges by copying and extracting credentials from SAM, SYSTEM, or other critical files.</div></p><p>I made a backup of SAM and SYSTEM using <code>reg save</code> command and downloaded them to my machine.<br> <img src="../images//ad-series-1/ss13.png" alt="" class="post-image"></p><p>Using the tool <code>secretsdump.py</code> I was able to dump the hash of the Administrator.<br> <img src="../images//ad-series-1/ss15.png" alt="" class="post-image"></p><p>With the Administrator hash I got, I used Pass the Hash attack to successfully logged in as Administrator.<br> <img src="../images//ad-series-1/ss16.png" alt="" class="post-image"></p><p><h1>Conclusion</h1></p><p>That's how I completed this challenge. Thank you for reading! I hope you learned something from here.</p>
                </div>

                <footer class="post-footer">
                    <div class="post-navigation">
                        <a href="../index.html" class="nav-link">‚Üê Back to Blog</a>
                    </div>
                </footer>
            </article>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>Tender Juicy Hatdog <span class="heart">üå≠</span> Hacking is not a crime.</p>
        </div>
    </footer>

    <canvas id="matrixCanvas"></canvas>
    <script src="../js/mobile.js"></script>
    <script src="../js/matrix.js"></script>
</body>
</html>